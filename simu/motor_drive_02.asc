Version 4
SHEET 1 1528 1284
WIRE 224 -336 224 -384
WIRE 128 -240 128 -272
WIRE 320 -240 304 -240
WIRE 560 -240 560 -272
WIRE 560 -240 400 -240
WIRE -416 -224 -416 -288
WIRE 224 -224 224 -256
WIRE 224 -224 192 -224
WIRE 256 -224 224 -224
WIRE 304 -224 304 -240
WIRE 304 -224 256 -224
WIRE -288 -192 -352 -192
WIRE -16 -192 -16 -240
WIRE 32 -192 -16 -192
WIRE 64 -192 32 -192
WIRE 224 -160 192 -160
WIRE 256 -160 224 -160
WIRE 304 -160 256 -160
WIRE -640 -144 -736 -144
WIRE -480 -144 -576 -144
WIRE 304 -144 304 -160
WIRE 320 -144 304 -144
WIRE 560 -144 560 -160
WIRE 560 -144 400 -144
WIRE 128 -112 128 -144
WIRE -16 -96 -16 -192
WIRE -16 -96 -352 -96
WIRE 32 -48 32 -192
WIRE 96 -48 32 -48
WIRE 224 -48 224 -160
WIRE 224 -48 176 -48
WIRE -416 0 -416 -64
WIRE 560 112 560 -144
WIRE -128 128 -160 128
WIRE -32 128 -64 128
WIRE 192 128 192 96
WIRE 384 128 384 64
WIRE 384 128 256 128
WIRE 512 128 384 128
WIRE -192 224 -384 224
WIRE -160 224 -160 128
WIRE -160 224 -192 224
WIRE -128 224 -160 224
WIRE -32 224 -32 128
WIRE -32 224 -48 224
WIRE 192 224 192 192
WIRE 192 224 -32 224
WIRE 256 224 256 128
WIRE 256 224 192 224
WIRE 1280 224 1280 192
WIRE -192 240 -192 224
WIRE -512 256 -512 160
WIRE -576 288 -816 288
WIRE -384 288 -384 224
WIRE -384 288 -448 288
WIRE 560 336 560 208
WIRE 752 336 752 304
WIRE 752 336 560 336
WIRE 1280 336 1280 304
WIRE -576 352 -672 352
WIRE -192 352 -192 320
WIRE -192 352 -448 352
WIRE -672 368 -672 352
WIRE 752 400 752 336
WIRE -192 416 -192 352
WIRE -160 416 -192 416
WIRE -128 416 -160 416
WIRE -32 416 -48 416
WIRE 256 416 -32 416
WIRE 1264 432 1232 432
WIRE 1328 432 1264 432
WIRE 1360 432 1328 432
WIRE 1472 432 1440 432
WIRE 1264 464 1264 432
WIRE -992 480 -992 416
WIRE -816 480 -816 288
WIRE -816 480 -992 480
WIRE -672 480 -672 448
WIRE -512 480 -512 384
WIRE 560 480 560 336
WIRE -160 512 -160 416
WIRE -128 512 -160 512
WIRE -32 512 -32 416
WIRE -32 512 -64 512
WIRE 1328 512 1328 432
WIRE 752 544 752 480
WIRE 256 560 256 416
WIRE 480 560 480 512
WIRE 480 560 256 560
WIRE 512 560 480 560
WIRE -992 576 -992 480
WIRE 1264 576 1264 544
WIRE 1296 576 1264 576
WIRE 256 608 256 560
WIRE 1264 608 1264 576
WIRE -992 688 -992 656
WIRE 752 688 752 624
WIRE 256 704 256 672
WIRE 1264 720 1264 688
WIRE 1328 720 1328 640
WIRE 1328 720 1264 720
WIRE 1328 736 1328 720
WIRE -768 880 -768 832
WIRE 64 896 64 832
WIRE 192 928 128 928
WIRE 224 928 192 928
WIRE 272 928 224 928
WIRE 560 928 560 576
WIRE 560 928 352 928
WIRE -480 944 -480 880
WIRE 224 944 224 928
WIRE 560 944 560 928
WIRE -352 976 -416 976
WIRE -224 976 -224 944
WIRE -96 976 -224 976
WIRE 0 976 -96 976
WIRE -768 1024 -768 960
WIRE -672 1024 -768 1024
WIRE -544 1024 -608 1024
WIRE 160 1024 128 1024
WIRE 224 1024 224 1008
WIRE 224 1024 160 1024
WIRE 272 1024 224 1024
WIRE 480 1024 352 1024
WIRE 480 1056 480 1024
WIRE 560 1056 560 1024
WIRE 560 1056 480 1056
WIRE -224 1072 -224 976
WIRE -224 1072 -416 1072
WIRE 64 1120 64 1056
WIRE 560 1120 560 1056
WIRE 192 1152 192 928
WIRE -480 1168 -480 1104
WIRE -96 1200 -96 976
WIRE 0 1200 -96 1200
WIRE 160 1200 160 1024
WIRE 160 1200 80 1200
WIRE 192 1264 192 1232
FLAG 1280 192 vcc
FLAG 1280 336 0
FLAG -992 688 0
FLAG 560 1120 0
FLAG 560 -272 vcc
FLAG 752 688 0
FLAG -992 416 v_cmd
FLAG 752 304 v_out
FLAG 384 64 vg_hs
FLAG 480 512 vg_ls
FLAG -512 160 vcc
FLAG -512 480 0
FLAG -672 480 0
FLAG 256 704 0
FLAG 192 96 vcc
FLAG 64 832 vcc
FLAG 64 1120 0
FLAG 192 1264 0
FLAG -224 944 v_sense_l
FLAG 128 -272 vcc
FLAG 128 -112 0
FLAG 224 -384 0
FLAG -16 -240 v_sens_h
FLAG -416 -288 vcc
FLAG -416 0 0
FLAG -480 880 vcc
FLAG -480 1168 0
FLAG -768 832 vcc
FLAG 1328 736 0
FLAG 1472 432 vcc
FLAG 1232 432 ocp_thres
FLAG -288 -192 ocp_thres
FLAG -352 976 ocp_thres
FLAG -736 -144 v_ocp
FLAG -768 1024 v_ocp
SYMBOL voltage 1280 208 R0
SYMATTR InstName V1
SYMATTR Value 24
SYMBOL nmos 512 480 R0
SYMATTR InstName M1
SYMATTR Value IPB080N03L
SYMBOL voltage -992 560 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value PULSE(0 24 0 1u 1u 20u 40u 10000)
SYMBOL ind 736 384 R0
SYMATTR InstName L1
SYMATTR Value {L_motor}
SYMBOL res 736 528 R0
SYMATTR InstName R1
SYMATTR Value {R_motor}
SYMBOL pmos 512 208 M180
SYMATTR InstName M2
SYMATTR Value Si4427DY
SYMBOL AutoGenerated\\UCC27531_TRANS -512 320 R0
SYMATTR InstName U1
SYMBOL voltage -672 352 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value 10
SYMBOL res -32 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 100
SYMBOL res -32 400 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 200
SYMBOL res -208 224 R0
SYMATTR InstName R5
SYMATTR Value 0
SYMBOL cap 176 128 R0
SYMATTR InstName C1
SYMATTR Value 1n
SYMBOL cap 240 608 R0
SYMATTR InstName C2
SYMATTR Value 1n
SYMBOL schottky -128 144 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky -64 496 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D2
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 544 928 R0
SYMATTR InstName R4
SYMATTR Value {Rshunt}
SYMBOL AutoGenerated\\LM2904_NS 64 976 M0
SYMATTR InstName U2
SYMBOL res 368 912 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL res 368 1008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL cap 208 944 R0
SYMATTR InstName C3
SYMATTR Value 1n
SYMBOL res 176 1136 R0
SYMATTR InstName R8
SYMATTR Value 100k
SYMBOL res 96 1184 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 100k
SYMBOL res 544 -256 R0
SYMATTR InstName R10
SYMATTR Value {Rshunt}
SYMBOL AutoGenerated\\TL072 160 -192 M0
SYMATTR InstName U3
SYMBOL res 416 -256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL res 416 -160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL cap 240 -224 R0
SYMATTR InstName C4
SYMATTR Value 1n
SYMBOL res 192 -64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 100k
SYMBOL res 208 -352 R0
SYMATTR InstName R14
SYMATTR Value 100k
SYMBOL AutoGenerated\\LM2904_NS -416 -144 M0
SYMATTR InstName U4
SYMBOL AutoGenerated\\LM2904_NS -480 1024 M0
SYMATTR InstName U5
SYMBOL res -784 864 R0
SYMATTR InstName R17
SYMATTR Value 10k
SYMBOL AutoGenerated\\TL431 1328 576 R0
SYMATTR InstName U6
SYMBOL res 1248 448 R0
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL res 1248 592 R0
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL res 1456 416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 4.7k
SYMBOL diode -640 -128 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL diode -672 1040 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D4
SYMATTR Value 1N4148
TEXT 1152 -192 Left 2 !.tran 20m
TEXT 1152 -96 Left 2 !.PARAM K_t = 900u\n.PARAM K_EMF = 900u\n.PARAM L_motor = 50u\n.PARAM R_motor = 24/6\n.PARAM R_loss = 300n\n.PARAM L_inertia = 15n
TEXT 736 944 Left 2 !.param Rshunt=10m
